<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Candidates - Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; font-family: Arial, sans-serif; }
    .sidebar { min-height: 100vh; background: linear-gradient(180deg, #e6e6fa, #dcd6f7); padding-top: 20px; }
    .sidebar h4 { color: #4a3f91; font-weight: bold; text-align: center; }
    .sidebar a { display: block; color: #4a3f91; padding: 10px 20px; text-decoration: none; border-radius: 6px; margin: 5px 10px; }
    .sidebar a:hover, .sidebar a.active { background: #b8aef5; color: white; }
    .content { padding: 20px; }
  </style>
</head>
<body>
<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <nav class="col-md-2 sidebar">
      <h4>üó≥Ô∏è Admin</h4>
      <a href="AdminDashboard.html">Dashboard</a>
      <a href="Adminsidepage2.html">Manage Voters</a>
      <a href="Adminsidepage3.html" class="active">Manage Candidates</a>
      <a href="Adminsidepage4.html">Manage Elections</a>
      <a href="Adminsidepage5.html">Assign Candidates</a>
      <a href="Adminsidepage6.html">View Results</a>
      <a href="Adminsidepage7.html">Reports</a>
      <a href="Adminsidepage8.html">Settings</a>
      <a href="Adminsidepage9.html" class="text-danger">Logout</a>
    </nav>

    <!-- Content -->
    <main class="col-md-10 content">
      <nav class="navbar navbar-light bg-light mb-4 rounded shadow-sm">
        <div class="container-fluid">
          <span class="navbar-brand fw-bold text-primary">Manage Candidates</span>
        </div>
      </nav>

      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">Candidate List</div>
        <div class="card-body">
          <button class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#addModal">+ Add Candidate</button>
          <table class="table table-striped" id="candidatesTable">
            <thead>
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Party</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <!-- Candidates will be populated here -->
            </tbody>
          </table>
        </div>
      </div>
    </main>
  </div>
</div>

<!-- Add/Edit Modal -->
<div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form id="candidateForm" class="modal-content needs-validation" novalidate>
      <div class="modal-header">
        <h5 class="modal-title" id="addModalLabel">Add/Edit Candidate</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
          <input type="hidden" id="editIndex">
          <div class="mb-3">
            <label class="form-label">Full Name</label>
            <input type="text" class="form-control" id="candidateName" required>
            <div class="invalid-feedback">Enter candidate name</div>
          </div>
          <div class="mb-3">
            <label class="form-label">Party</label>
            <input type="text" class="form-control" id="candidateParty" required>
            <div class="invalid-feedback">Enter party name</div>
          </div>
          <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="candidateStatus">
            <label class="form-check-label" for="candidateStatus">Active</label>
          </div>
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary">Save</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
      </div>
    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Populate table
  function renderTable() {
    const candidates = JSON.parse(localStorage.getItem('candidates') || "[]");
    const tbody = document.querySelector("#candidatesTable tbody");
    tbody.innerHTML = "";
    candidates.forEach((c, index) => {
      tbody.innerHTML += `
        <tr>
          <td>${index + 1}</td>
          <td>${c.name}</td>
          <td>${c.party || "Independent"}</td>
          <td><span class="badge ${c.status === "Active" ? "bg-success" : "bg-secondary"}">${c.status}</span></td>
          <td>
            <button class="btn btn-sm btn-warning" onclick="editCandidate(${index})">Edit</button>
            <button class="btn btn-sm btn-danger" onclick="deleteCandidate(${index})">Delete</button>
          </td>
        </tr>
      `;
    });
  }

  function editCandidate(index) {
    const candidates = JSON.parse(localStorage.getItem('candidates') || "[]");
    const c = candidates[index];
    document.getElementById('editIndex').value = index;
    document.getElementById('candidateName').value = c.name;
    document.getElementById('candidateParty').value = c.party || "";
    document.getElementById('candidateStatus').checked = c.status === "Active";
    const modal = new bootstrap.Modal(document.getElementById('addModal'));
    modal.show();
  }

  function deleteCandidate(index) {
    if(confirm("Are you sure you want to delete this candidate?")) {
      const candidates = JSON.parse(localStorage.getItem('candidates') || "[]");
      candidates.splice(index, 1);
      localStorage.setItem('candidates', JSON.stringify(candidates));
      renderTable();
    }
  }

  document.getElementById('candidateForm').addEventListener('submit', e => {
    e.preventDefault();
    const form = e.target;
    if (!form.checkValidity()) return form.classList.add('was-validated');

    const index = document.getElementById('editIndex').value;
    const candidates = JSON.parse(localStorage.getItem('candidates') || "[]");
    const candidateData = {
      name: document.getElementById('candidateName').value,
      party: document.getElementById('candidateParty').value || "Independent",
      status: document.getElementById('candidateStatus').checked ? "Active" : "Inactive"
    };

    if (index === "") {
      candidates.push(candidateData); // Add new
    } else {
      candidates[index] = candidateData; // Edit existing
    }

    localStorage.setItem('candidates', JSON.stringify(candidates));
    renderTable();
    bootstrap.Modal.getInstance(document.getElementById('addModal')).hide();
    form.reset();
    form.classList.remove('was-validated');
  });

  renderTable();
</script>
</body>
</html>
