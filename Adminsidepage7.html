<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reports - Online Voting System</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; font-family: Arial, sans-serif; }
    .sidebar { min-height: 100vh; background: linear-gradient(180deg, #e6e6fa, #dcd6f7); padding-top: 20px; }
    .sidebar h4 { color: #4a3f91; font-weight: bold; }
    .sidebar a { color: #4a3f91; display: block; padding: 10px 20px; border-radius: 6px; font-weight: 500; text-decoration: none; }
    .sidebar a:hover, .sidebar a.active { background: #b8aef5; color: white; }
    .content { padding: 20px; }
    #reportOutput { margin-top: 20px; }
  </style>
</head>
<body>
<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <nav class="col-md-2 sidebar">
      <h4 class="text-center">üó≥Ô∏è Admin</h4>
      <a href="AdminDashboard.html">Dashboard</a>
      <a href="Adminsidepage2.html">Manage Voters</a>
      <a href="Adminsidepage3.html">Manage Candidates</a>
      <a href="Adminsidepage4.html">Manage Elections</a>
      <a href="Adminsidepage5.html">Assign Candidates</a>
      <a href="Adminsidepage6.html">View Results</a>
      <a href="Adminsidepage7.html" class="active">Reports</a>
      <a href="Adminsidepage8.html">Settings</a>
      <a href="Adminsidepage9.html" class="text-danger">Logout</a>
    </nav>

    <!-- Content -->
    <main class="col-md-10 content">
      <nav class="navbar navbar-light bg-light mb-4 rounded shadow-sm">
        <div class="container-fluid">
          <span class="navbar-brand fw-bold text-primary">Reports</span>
        </div>
      </nav>

      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="mb-3">Generate Reports</h5>
          <form id="reportForm">
            <div class="mb-3">
              <label for="reportType" class="form-label">Select Report Type</label>
              <select class="form-select" id="reportType">
                <option value="voter">Voter Report</option>
                <option value="candidate">Candidate Report</option>
                <option value="election">Election Report</option>
                <option value="result">Results Report</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="exportFormat" class="form-label">Export Format</label>
              <select class="form-select" id="exportFormat">
                <option value="pdf">PDF / Print</option>
                <option value="excel">Excel</option>
              </select>
            </div>
            <button type="submit" class="btn btn-primary">Generate Report</button>
          </form>

          <div id="reportOutput"></div>
        </div>
      </div>
    </main>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script>
  const form = document.getElementById("reportForm");
  const output = document.getElementById("reportOutput");

  // Dummy data ‚Äî replace these with real localStorage values
  const voters = JSON.parse(localStorage.getItem("voters")) || [
    { name: "Aarav Patel", email: "aarav@gmail.com", status: "Voted" },
    { name: "Neha Sharma", email: "neha@gmail.com", status: "Not Voted" }
  ];
  const candidates = JSON.parse(localStorage.getItem("candidates")) || [
    { name: "Ravi Kumar", party: "ABC Party", status: "Active", votes: 120 },
    { name: "Sneha Mehta", party: "XYZ Party", status: "Active", votes: 95 }
  ];
  const elections = JSON.parse(localStorage.getItem("elections")) || [
    { name: "Presidential Election 2025", start: "01-01-2025", end: "31-01-2025", status: "Active" }
  ];

  form.addEventListener("submit", (e) => {
    e.preventDefault();

    const type = document.getElementById("reportType").value;
    const format = document.getElementById("exportFormat").value;
    let data = [];
    let html = "";

    if (type === "voter") {
      data = voters;
      html = `<h5 class='mt-3'>Voter Report</h5><table class='table table-bordered'><thead><tr><th>Name</th><th>Email</th><th>Status</th></tr></thead><tbody>${data.map(v => `<tr><td>${v.name}</td><td>${v.email}</td><td>${v.status}</td></tr>`).join("")}</tbody></table>`;
    } else if (type === "candidate") {
      data = candidates;
      html = `<h5 class='mt-3'>Candidate Report</h5><table class='table table-bordered'><thead><tr><th>Name</th><th>Party</th><th>Status</th><th>Votes</th></tr></thead><tbody>${data.map(c => `<tr><td>${c.name}</td><td>${c.party}</td><td>${c.status}</td><td>${c.votes}</td></tr>`).join("")}</tbody></table>`;
    } else if (type === "election") {
      data = elections;
      html = `<h5 class='mt-3'>Election Report</h5><table class='table table-bordered'><thead><tr><th>Name</th><th>Start</th><th>End</th><th>Status</th></tr></thead><tbody>${data.map(e => `<tr><td>${e.name}</td><td>${e.start}</td><td>${e.end}</td><td>${e.status}</td></tr>`).join("")}</tbody></table>`;
    } else if (type === "result") {
      const sorted = [...candidates].sort((a, b) => b.votes - a.votes);
      const winner = sorted[0];
      html = `<h5 class='mt-3'>Results Report</h5><table class='table table-bordered'><thead><tr><th>Candidate</th><th>Party</th><th>Votes</th></tr></thead><tbody>${sorted.map(c => `<tr><td>${c.name}</td><td>${c.party}</td><td>${c.votes}</td></tr>`).join("")}</tbody></table><div class='alert alert-success mt-3'><strong>üèÜ Winner:</strong> ${winner.name} (${winner.party}) with ${winner.votes} votes.</div>`;
    }

    output.innerHTML = html;

    // Export options
    if (format === "pdf") {
      setTimeout(() => window.print(), 500);
    } else if (format === "excel") {
      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.json_to_sheet(data);
      XLSX.utils.book_append_sheet(wb, ws, "Report");
      XLSX.writeFile(wb, `${type}_report.xlsx`);
    }
  });
</script>
</body>
</html>
